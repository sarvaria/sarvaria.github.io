<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="application/xhtml+xml;charset=utf-8" />
    </head>

    <style>
        .weektitle {
            font-weight: bold;
        }

        table {
            margin-bottom: 16px;
        }

        table .header td {
            font-weight: bold;
            text-align: center;
            border: solid 1px;
            width: 180px;
        }

        table .menu input {
            width: 180px;
        }
    </style>
<body>

    <!-- Input -->

    <div>
        <div class="weektitle">Időszak</div>
        <div>
            <div>Tól:<input id="from" type="text" onkeyup="generate()"></div>
            <div>Ig:<input id="to" type="text" onkeyup="generate()"></div>
        </div>
    </div>

    <table id="menu">
        <tr class="header"><td>HÉTFŐ</td><td>KEDD</td><td>SZERDA</td><td>CSÜTÖRTÖK</td><td>PÉNTEK</td><td>SZOMBAT</td><td>VASÁRNAP</td></tr>
        <tr class="menu"><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td></tr>
        <tr class="menu"><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td></tr>
        <tr class="menu"><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td></tr>
        <tr class="menu"><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td></tr>
        <tr class="menu"><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td><td><input type="text" onkeyup="generate()"></td></tr>
    </table>

<div style="display: none">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" baseProfile="full" width="1170" height="826">
  <text x="585" y="300" text-anchor="middle" fill="#000000" style="font-family: Verdana;font-weight:bold;font-style:italic;font-size: 22px;">9970 Szentgotthárd, Mártírok u. 1.</text>
  <text x="585" y="330" text-anchor="middle" fill="#000000" style="font-family: Verdana;font-weight:normal;font-style:italic;font-size: 18px;">Ételkiszállítás 94/554-166</text>
  <text id="week" x="585" y="385" text-anchor="middle" fill="#000000" style="font-family: Verdana;font-weight:normal;font-style:italic;font-size: 18px;">Előfizetéses ebéd ajánlat: augusztus 14 - augusztus 20</text>
  <text x="585" y="685" text-anchor="middle" fill="#000000" style="font-family: Verdana;font-weight:normal;font-size: 14px;">(aktuális napi rendelés esetén az ár 950.- Ft)</text>
  <text x="585" y="705" text-anchor="middle" fill="#000000" style="font-family: Verdana;font-weight:bold;font-style:italic;font-size: 14px;">900.- Ft/adag Kiszállítva 900.- Ft/adag</text>
  <text x="794" y="765" text-anchor="middle" fill="#000000" style="font-family: Verdana;font-weight:bold;font-style:italic;font-size: 12px;">"A változás jogát fenntartjuk"</text>
  <text x="1000" y="765" text-anchor="middle" fill="#000000" style="font-family: Verdana;font-weight:bold;font-style:italic;font-size: 12px;">"Jó étvágyat kívánunk"</text>

  <text x="100" y="472" text-anchor="middle" fill="#000000" style="font-family: Verdana;font-weight:normal;font-style:italic;font-size: 14px;">HÉTFŐ</text>
  <text x="260" y="472" text-anchor="middle" fill="#000000" style="font-family: Verdana;font-weight:normal;font-style:italic;font-size: 14px;">KEDD</text>
  <text x="420" y="472" text-anchor="middle" fill="#000000" style="font-family: Verdana;font-weight:normal;font-style:italic;font-size: 14px;">SZERDA</text>
  <text x="580" y="472" text-anchor="middle" fill="#000000" style="font-family: Verdana;font-weight:normal;font-style:italic;font-size: 14px;">CSÜTÖRTÖK</text>
  <text x="740" y="472" text-anchor="middle" fill="#000000" style="font-family: Verdana;font-weight:normal;font-style:italic;font-size: 14px;">PÉNTEK</text>
  <text x="900" y="472" text-anchor="middle" fill="#000000" style="font-family: Verdana;font-weight:normal;font-style:italic;font-size: 14px;">SZOMBAT</text>
  <text x="1060" y="472" text-anchor="middle" fill="#000000" style="font-family: Verdana;font-weight:normal;font-style:italic;font-size: 14px;">VASÁRNAP</text>

  <rect x="20" y="480" width="1130" height="185" style="stroke-width:1px;stroke:#8a854c;fill:none" />
  <line x1="180" y1="480" x2="180" y2="665" style="stroke-width:1px;stroke:#8a854c;fill:none" />
  <line x1="340" y1="480" x2="340" y2="665" style="stroke-width:1px;stroke:#8a854c;fill:none" />
  <line x1="500" y1="480" x2="500" y2="665" style="stroke-width:1px;stroke:#8a854c;fill:none" />
  <line x1="660" y1="480" x2="660" y2="665" style="stroke-width:1px;stroke:#8a854c;fill:none" />
  <line x1="820" y1="480" x2="820" y2="665" style="stroke-width:1px;stroke:#8a854c;fill:none" />
  <line x1="980" y1="480" x2="980" y2="665" style="stroke-width:1px;stroke:#8a854c;fill:none" />

  <text x="900" y="660" text-anchor="middle" fill="#000000" style="font-family: Verdana;font-weight:normal;font-style:italic;font-size: 14px;">(1000.-ft/adag)</text>
  <text x="1060" y="660" text-anchor="middle" fill="#000000" style="font-family: Verdana;font-weight:normal;font-style:italic;font-size: 14px;">(1000.-ft/adag)</text>
</svg>
</div>
<canvas id="canvas" style="display: none"></canvas>
<canvas id="preview"></canvas>
<br><br>
<a id="link">Kép</a>
<script>

function b64EncodeUnicode(str) {
    // first we use encodeURIComponent to get percent-encoded UTF-8,
    // then we convert the percent encodings into raw bytes which
    // can be fed into btoa.
    return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,
        function toSolidBytes(match, p1) {
            return String.fromCharCode('0x' + p1);
    }));
}

var menu;
    var width = 1170;
    var height = 826;

    var preview;
    var previewCtx;

    var x = 100;
    var y = 514;
    var distanceX = 160;
    var distanceY = 26;

function generate() {
    document.getElementById('week').innerHTML = 'Előfizetéses ebéd ajánlat: ' + document.getElementById('from').value + ' - ' + document.getElementById('to').value;
    var svg = document.querySelector('svg').cloneNode(true);
    var input = document.getElementById('menu').getElementsByTagName('input');
    menu = [
        ['', '', '', '', ''],
        ['', '', '', '', ''],
        ['', '', '', '', ''],
        ['', '', '', '', ''],
        ['', '', '', '', ''],
        ['', '', '', '', ''],
        ['', '', '', '', '']
    ];
    var row = -1;

    for (var i = 0; i < menu.length; i++) {
        for (var j = 0; j < menu[i].length; j++) {
            menu[i][j] = input[(j * 7) + i].value;
        }
    }


    for (var i = 0; i < menu.length; i++) {
        for (var j = 0; j < menu[i].length; j++) {
            var text = document.createElementNS("http://www.w3.org/2000/svg", 'text');
            text.setAttribute('x', x + (distanceX * i));
            text.setAttribute('y', y + (distanceY * j));
            text.setAttribute('text-anchor', 'middle');
            text.setAttribute('fill', '#000000');
            text.setAttribute('style', 'font-family: Verdana;font-weight:bold;font-style:italic;font-size: 14px;');
            text.innerHTML = menu[i][j];
            svg.appendChild(text);
        }
    }

    var svgData = new XMLSerializer().serializeToString( svg );

    var canvas = document.getElementById('canvas');
    canvas.width = width;
    canvas.height = height;
    var ctx = canvas.getContext( "2d" );
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    var img = new Image();
    img.src = 'empty_menu.png';
    img.onload = function() {
        ctx.drawImage(img,0,0);

        var img2 = document.createElement( "img" );
        img2.setAttribute( "src", "data:image/svg+xml;base64," + b64EncodeUnicode( svgData ) );

        img2.onload = function() {
            ctx.drawImage( img2, 0, 0 );
            previewCtx.drawImage(canvas, 0, 0, width, height, 0, 0, preview.width, preview.height);

            var content = canvas.toDataURL( "image/png" );
            document.getElementById('link').setAttribute('href', content);
        };
    };
}

            function init() {
                var fromDate = new Date();
                fromDate.setDate(fromDate.getDate() + 7);
                fromDate.setDate(fromDate.getDate() - fromDate.getDay() + 1);
                var toDate = new Date(fromDate.getTime());
                toDate.setDate(toDate.getDate() + 6);

                var month = [
                    'január',
                    'február',
                    'március',
                    'április',
                    'május',
                    'június',
                    'július',
                    'augusztus',
                    'szeptember',
                    'október',
                    'november',
                    'december'
                ];

                document.getElementById('from').value = month[fromDate.getMonth()] + ' ' + fromDate.getDate();
                document.getElementById('to').value = month[toDate.getMonth()] + ' ' + toDate.getDate();
            }

            /**
             * Auto starter.
             */
             
            (function () {
                preview = document.getElementById('preview');
                preview.width = width / 2;
                preview.height = height / 2;
                previewCtx = preview.getContext('2d');

                init();

                generate();
                /*var width = 1170;
                var height = 826;

                var preview = document.getElementById('preview');
                preview.width = width / 2;
                preview.height = height / 2;
                var previewCtx = preview.getContext('2d');

                var x = 265;
                var y = 514;
                var distanceX = 160;
                var distanceY = 26;

                var svg = document.querySelector('svg');

                for (var i = 0; i < menu.length; i++) {
                    for (var j = 0; j < menu[i].length; j++) {
                        var text = document.createElementNS("http://www.w3.org/2000/svg", 'text');
                        text.setAttribute('x', x + (distanceX * i));
                        text.setAttribute('y', y + (distanceY * j));
                        text.setAttribute('text-anchor', 'middle');
                        text.setAttribute('fill', '#000000');
                        text.setAttribute('style', 'font-family: Verdana;font-weight:bold;font-style:italic;font-size: 14px;');
                        text.innerHTML = menu[i][j];
                        svg.appendChild(text);
                    }
                }

                var svg = document.querySelector( "svg" );
                var svgData = new XMLSerializer().serializeToString( svg );

                var canvas = document.getElementById('canvas');
                canvas.width = width;
                canvas.height = height;
                var ctx = canvas.getContext( "2d" );
                var img = new Image();
                img.src = 'empty_menu.png';
                img.onload = function() {
                    ctx.drawImage(img,0,0);

                    var img2 = document.createElement( "img" );
                    img2.setAttribute( "src", "data:image/svg+xml;base64," + b64EncodeUnicode( svgData ) );

                    img2.onload = function() {
                        ctx.drawImage( img2, 0, 0 );
                        previewCtx.drawImage(canvas, 0, 0, width, height, 0, 0, preview.width, preview.height);

                        var content = canvas.toDataURL( "image/png" );
                        document.getElementById('link').setAttribute('href', content);
                    };
                };*/

            })();
    </script>
</body>
</html>
